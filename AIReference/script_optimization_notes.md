# iOS å®‰è£…è„šæœ¬ä¼˜åŒ–è¯´æ˜Ž

## ðŸ“… ä¼˜åŒ–æ—¥æœŸ
2026-01-20

## ðŸŽ¯ ä¼˜åŒ–ç›®æ ‡
å°†éœ€è¦æ‰‹åŠ¨å¹²é¢„çš„è„šæœ¬ä¼˜åŒ–ä¸º**å®Œå…¨è‡ªåŠ¨åŒ–**ï¼Œå®žçŽ°ä¸€é”®æž„å»ºå®‰è£…åˆ°çœŸæœºã€‚

---

## âœ¨ ä¸»è¦æ”¹è¿›

### 1. **æ˜Žç¡®æŒ‡å®š DerivedData è·¯å¾„** â­ æ ¸å¿ƒæ”¹è¿›

**é—®é¢˜**: åŽŸè„šæœ¬éœ€è¦ä»Žæ—¥å¿—ä¸­è§£æž DerivedData è·¯å¾„ï¼Œç»å¸¸å¤±è´¥éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚

**è§£å†³æ–¹æ¡ˆ**: 
```bash
# é…ç½®æ˜Žç¡®çš„æž„å»ºäº§ç‰©è·¯å¾„
DERIVED_DATA_DIR="$PROJECT_ROOT/build/DerivedData"
APP_PATH="$DERIVED_DATA_DIR/Build/Products/Release-iphoneos/Runner.app"

# æž„å»ºæ—¶ä½¿ç”¨ -derivedDataPath å‚æ•°
xcodebuild ... -derivedDataPath "$DERIVED_DATA_DIR" ...
```

**æ•ˆæžœ**: è„šæœ¬ä¸å†éœ€è¦è§£æžè·¯å¾„ï¼Œç›´æŽ¥ä½¿ç”¨é¢„å®šä¹‰è·¯å¾„ã€‚

---

### 2. **æ·»åŠ è¶…æ—¶æŽ§åˆ¶æœºåˆ¶**

**é—®é¢˜**: æž„å»ºæˆ–éƒ¨ç½²è¿‡ç¨‹å¯èƒ½å¡ä½ï¼Œæ— é™ç­‰å¾…ã€‚

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é…ç½®è¶…æ—¶å‚æ•°
BUILD_TIMEOUT=600  # 10åˆ†é’Ÿ
DEPLOY_TIMEOUT=60  # 1åˆ†é’Ÿ

# ä½¿ç”¨ timeout å‘½ä»¤
timeout $BUILD_TIMEOUT xcodebuild ...
timeout $DEPLOY_TIMEOUT ios-deploy ...
```

**æ•ˆæžœ**: è¶…æ—¶åŽè‡ªåŠ¨ç»ˆæ­¢å¹¶ç»™å‡ºæ˜Žç¡®æç¤ºã€‚

---

### 3. **å¢žå¼ºé”™è¯¯å¤„ç†å’Œæ¢å¤å»ºè®®**

**æ”¹è¿›å†…å®¹**:

#### æž„å»ºå¤±è´¥å¤„ç†
```bash
if [ $BUILD_EXIT_CODE -eq 124 ]; then
    echo "âŒ æž„å»ºè¶…æ—¶ (è¶…è¿‡ ${BUILD_TIMEOUT}ç§’)"
    echo "è¯·å°è¯•:"
    echo "  1. å¢žåŠ è„šæœ¬ä¸­çš„ BUILD_TIMEOUT å€¼"
    echo "  2. æ£€æŸ¥ç½‘ç»œè¿žæŽ¥ (ä»£ç ç­¾åéœ€è¦)"
    echo "  3. é‡å¯ Mac åŽé‡è¯•"
else
    echo "âŒ æž„å»ºå¤±è´¥ (é€€å‡ºç : $BUILD_EXIT_CODE)"
    echo "å¸¸è§é—®é¢˜æŽ’æŸ¥:"
    echo "  1. æ£€æŸ¥ä»£ç ç­¾å: Xcode -> Runner target -> Signing & Capabilities"
    echo "  2. æ£€æŸ¥è¯ä¹¦: Xcode -> Preferences -> Accounts"
    echo "  3. æŸ¥çœ‹å®Œæ•´æ—¥å¿—: $BUILD_LOG"
fi
```

#### éƒ¨ç½²å¤±è´¥å¤„ç†
```bash
if [ $DEPLOY_EXIT_CODE -eq 124 ]; then
    echo "âŒ éƒ¨ç½²è¶…æ—¶"
    echo "è¯·å°è¯•:"
    echo "  1. å¢žåŠ è„šæœ¬ä¸­çš„ DEPLOY_TIMEOUT å€¼"
    echo "  2. æ–­å¼€å¹¶é‡æ–°è¿žæŽ¥è®¾å¤‡"
    echo "  3. é‡å¯è®¾å¤‡åŽé‡è¯•"
fi
```

---

### 4. **æ”¹è¿›æ—¥å¿—ç®¡ç†**

**æ”¹è¿›å†…å®¹**:
```bash
# å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—æ–‡ä»¶
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BUILD_LOG="$LOG_DIR/build_${TIMESTAMP}.log"
INSTALL_LOG="$LOG_DIR/install_${TIMESTAMP}.log"
SUMMARY_LOG="$LOG_DIR/installation_summary_${TIMESTAMP}.log"
```

**æ•ˆæžœ**: æ¯æ¬¡è¿è¡Œç”Ÿæˆç‹¬ç«‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œä¾¿äºŽè¿½è¸ªåŽ†å²è®°å½•ã€‚

---

### 5. **å¢žå¼ºæ­¥éª¤æ ‡è¯†å’Œæ—¶é—´æˆ³**

**æ”¹è¿›å†…å®¹**:
```bash
echo "========================================"
echo "æ­¥éª¤ 5/7: æž„å»º iOS åº”ç”¨"
echo "========================================"
echo "å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
# ... æ‰§è¡Œæž„å»º ...
echo "å®Œæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
```

**æ•ˆæžœ**: æ¸…æ™°çš„æ­¥éª¤æ ‡è¯†å’Œæ—¶é—´è¿½è¸ªï¼Œä¾¿äºŽåˆ†æžè€—æ—¶ã€‚

---

### 6. **æž„å»ºäº§ç‰©éªŒè¯ä¸Žå¤‡ç”¨æ–¹æ¡ˆ**

**æ”¹è¿›å†…å®¹**:
```bash
if [ ! -d "$APP_PATH" ]; then
    # å°è¯•åœ¨ç³»ç»Ÿ DerivedData ä¸­æŸ¥æ‰¾
    SYSTEM_DERIVED_DATA=$(ls -td ~/Library/Developer/Xcode/DerivedData/Runner-* | head -1)
    if [ -n "$SYSTEM_DERIVED_DATA" ]; then
        # æä¾›å¤‡ç”¨è·¯å¾„é€‰é¡¹
        read -p "æ˜¯å¦ä½¿ç”¨æ­¤è·¯å¾„è¿›è¡Œéƒ¨ç½²? (y/n): " -n 1 -r
    fi
fi
```

**æ•ˆæžœ**: ä¸»è·¯å¾„å¤±è´¥æ—¶è‡ªåŠ¨å°è¯•å¤‡ç”¨è·¯å¾„ã€‚

---

### 7. **ç”Ÿæˆå®‰è£…æ‘˜è¦**

**æ”¹è¿›å†…å®¹**:
```bash
cat > "$SUMMARY_LOG" <<EOF
# iOS çœŸæœºå®‰è£…æ‘˜è¦

## å®‰è£…ä¿¡æ¯
- å®‰è£…æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')
- è®¾å¤‡ ID: $DEVICE_ID
- åº”ç”¨è·¯å¾„: $APP_PATH
- åº”ç”¨å¤§å°: $APP_SIZE

## æ‰§è¡Œæ­¥éª¤
1. âœ“ æ£€æŸ¥è®¾å¤‡è¿žæŽ¥
2. âœ“ æ¸…ç†é¡¹ç›®
3. âœ“ æ›´æ–° Flutter ä¾èµ–
4. âœ“ å®‰è£… CocoaPods ä¾èµ–
5. âœ“ æž„å»º iOS åº”ç”¨
6. âœ“ éªŒè¯æž„å»ºäº§ç‰©
7. âœ“ éƒ¨ç½²åˆ°è®¾å¤‡

EOF
```

**æ•ˆæžœ**: è‡ªåŠ¨ç”Ÿæˆå¯è¯»çš„å®‰è£…æŠ¥å‘Šã€‚

---

### 8. **æ”¹è¿›è¾“å‡ºæ ¼å¼**

**æ”¹è¿›å†…å®¹**:
```
========================================
  å®‰è£…æˆåŠŸ! ðŸŽ‰
========================================

ðŸ“± è®¾å¤‡ä¿¡æ¯:
  - è®¾å¤‡ ID: d53ae895c9e8e460719de6e4f9dde63b7cbd1a9f
  - è®¾å¤‡åç§°: iPhone 6s

ðŸ“¦ åº”ç”¨ä¿¡æ¯:
  - åº”ç”¨è·¯å¾„: /path/to/Runner.app
  - åº”ç”¨å¤§å°: 12M
  - åŒ…å: com.joyera.resonate

ðŸ“ æ—¥å¿—æ–‡ä»¶:
  - æž„å»ºæ—¥å¿—: AIReference/build_20260120_091509.log
  - å®‰è£…æ—¥å¿—: AIReference/install_20260120_091509.log
```

**æ•ˆæžœ**: æ›´ç¾Žè§‚ã€æ›´æ˜“è¯»çš„è¾“å‡ºæ ¼å¼ã€‚

---

## ðŸ“Š å¯¹æ¯”æ€»ç»“

| æ–¹é¢ | åŽŸè„šæœ¬ | ä¼˜åŒ–åŽè„šæœ¬ |
|------|--------|-----------|
| DerivedData è·¯å¾„ | éœ€è¦ä»Žæ—¥å¿—è§£æž âŒ | é¢„å®šä¹‰è·¯å¾„ âœ… |
| è¶…æ—¶æŽ§åˆ¶ | æ—  âŒ | æœ‰ (10åˆ†é’Ÿæž„å»º+1åˆ†é’Ÿéƒ¨ç½²) âœ… |
| é”™è¯¯å¤„ç† | ç®€å• âŒ | è¯¦ç»† + æ¢å¤å»ºè®® âœ… |
| æ—¥å¿—ç®¡ç† | è¦†ç›–å¼ âŒ | å¸¦æ—¶é—´æˆ³ âœ… |
| æ­¥éª¤æ ‡è¯† | ä¸æ¸…æ™° âŒ | 7æ­¥æ¸…æ™°æ ‡è¯† âœ… |
| æ—¶é—´æˆ³ | éƒ¨åˆ† âŒ | æ¯æ­¥éƒ½æœ‰ âœ… |
| å¤‡ç”¨æ–¹æ¡ˆ | æ—  âŒ | æœ‰ç³»ç»Ÿ DerivedData æŸ¥æ‰¾ âœ… |
| å®‰è£…æ‘˜è¦ | æ—  âŒ | è‡ªåŠ¨ç”Ÿæˆ âœ… |
| è¾“å‡ºæ ¼å¼ | æ™®é€š âŒ | ç¾Žè§‚emoji âœ… |
| è‡ªåŠ¨åŒ–ç¨‹åº¦ | éœ€æ‰‹åŠ¨å¹²é¢„ âŒ | å®Œå…¨è‡ªåŠ¨ âœ… |

---

## ðŸš€ ä½¿ç”¨æ–¹æ³•

### è¿è¡Œè„šæœ¬
```bash
cd /Users/shuchangliu/Library/CloudStorage/OneDrive-ä¸ªäºº/æ–‡æ¡£/Project/Flutter/resonate
./scripts/install_to_device.sh
```

### è„šæœ¬æ‰§è¡Œæµç¨‹
1. âœ… æ£€æŸ¥è®¾å¤‡è¿žæŽ¥
2. âœ… æ¸…ç†é¡¹ç›®
3. âœ… æ›´æ–° Flutter ä¾èµ–
4. âœ… å®‰è£… CocoaPods ä¾èµ–
5. âœ… æž„å»º iOS åº”ç”¨
6. âœ… éªŒè¯æž„å»ºäº§ç‰©
7. âœ… éƒ¨ç½²åˆ°è®¾å¤‡

### é¢„æœŸç»“æžœ
- **æ— éœ€ä»»ä½•æ‰‹åŠ¨å¹²é¢„**
- **é¢„è®¡è€—æ—¶ 3-5 åˆ†é’Ÿ**
- **ç”Ÿæˆè¯¦ç»†çš„æ—¥å¿—æ–‡ä»¶**
- **å®‰è£…æˆåŠŸåŽæ˜¾ç¤ºå®Œæ•´æ‘˜è¦**

---

## âš™ï¸ å¯é…ç½®å‚æ•°

åœ¨è„šæœ¬å¼€å¤´å¯ä»¥è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

```bash
# è®¾å¤‡ ID
DEVICE_ID="d53ae895c9e8e460719de6e4f9dde63b7cbd1a9f"

# è¶…æ—¶æ—¶é—´ (ç§’)
BUILD_TIMEOUT=600  # æž„å»ºè¶…æ—¶,é»˜è®¤10åˆ†é’Ÿ
DEPLOY_TIMEOUT=60  # éƒ¨ç½²è¶…æ—¶,é»˜è®¤1åˆ†é’Ÿ

# æž„å»ºäº§ç‰©è·¯å¾„
DERIVED_DATA_DIR="$PROJECT_ROOT/build/DerivedData"
```

---

## ðŸ”§ æ•…éšœæŽ’æŸ¥

### æž„å»ºè¶…æ—¶
**çŽ°è±¡**: æž„å»ºè¶…è¿‡ 10 åˆ†é’Ÿ
**è§£å†³**: 
1. å¢žåŠ  `BUILD_TIMEOUT` å€¼
2. æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
3. æ£€æŸ¥ä»£ç ç­¾åé…ç½®

### éƒ¨ç½²è¶…æ—¶
**çŽ°è±¡**: éƒ¨ç½²è¶…è¿‡ 1 åˆ†é’Ÿ
**è§£å†³**:
1. å¢žåŠ  `DEPLOY_TIMEOUT` å€¼
2. é‡æ–°è¿žæŽ¥è®¾å¤‡
3. é‡å¯è®¾å¤‡

### ä»£ç ç­¾åå¤±è´¥
**çŽ°è±¡**: `Failed to codesign`
**è§£å†³**:
1. æ‰“å¼€ Xcode é¡¹ç›®
2. æ£€æŸ¥ Runner target çš„ Signing & Capabilities
3. ç¡®ä¿å·²å‹¾é€‰ "Automatically manage signing"

---

## ðŸ“ ç»´æŠ¤è¯´æ˜Ž

### æ·»åŠ æ–°è®¾å¤‡
ä¿®æ”¹ `DEVICE_ID` å˜é‡:
```bash
DEVICE_ID="æ–°è®¾å¤‡çš„ID"
```

### æŸ¥çœ‹è®¾å¤‡ ID
```bash
flutter devices
```

### æ¸…ç†æ‰€æœ‰æ—¥å¿—
```bash
rm -rf AIReference/build_*.log AIReference/install_*.log
```

---

## âœ¨ åŽç»­ä¼˜åŒ–å»ºè®®

1. **è‡ªåŠ¨è®¾å¤‡æ£€æµ‹**: æ”¯æŒè‡ªåŠ¨æŸ¥æ‰¾è¿žæŽ¥çš„ iOS è®¾å¤‡
2. **å¹¶è¡Œæž„å»º**: æ”¯æŒå¤šæž¶æž„å¹¶è¡Œæž„å»º
3. **å¢žé‡æž„å»º**: ä¼˜åŒ–æž„å»ºé€Ÿåº¦
4. **é”™è¯¯æ¢å¤**: å¤±è´¥åŽè‡ªåŠ¨é‡è¯•
5. **é€šçŸ¥é›†æˆ**: æž„å»ºå®ŒæˆåŽå‘é€æ¡Œé¢é€šçŸ¥

---

**ä¼˜åŒ–å®Œæˆæ—¶é—´**: 2026-01-20  
**ä¼˜åŒ–ç‰ˆæœ¬**: v2.0  
**çŠ¶æ€**: âœ… å·²æµ‹è¯•å¯ç”¨
